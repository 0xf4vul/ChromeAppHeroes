const NetConfig={listUrl:"http://music.163.com/api/search/pc",songUrl:"http://music.163.com/weapi/song/enhance/player/url?csrf_token=",topListUrl:"http://music.163.com/weapi/v6/playlist/detail",lyricUrl:"http://music.163.com/weapi/song/lyric?os=osx&lv=-1&kv=-1&tv=-1&id=",csrf:"",br:32e4,ids:[],offset:0,type:1,defaultTop:60198,maxListNumber:100};class NetEaseSong{_create_secret_key(e){for(var t=[],r="012345679abcdef".split(""),s=0;s<e;s++){var a=Math.floor(Math.random()*r.length);t.push(r[a])}return t.join("")}_aes_encrypt(e,t){for(var r=16-e.length%16,s=0;s<r;s++)e+=String.fromCharCode(r);for(var a=aesjs.util.convertStringToBytes(t),n=aesjs.util.convertStringToBytes("0102030405060708"),i=aesjs.util.convertStringToBytes(e),o=new aesjs.ModeOfOperation.cbc(a,n),c=[];0!=i.length;){var p=o.encrypt(i.slice(0,16));Array.prototype.push.apply(c,p),i=i.slice(16)}var l="";for(s=0;s<c.length;s++)l+=String.fromCharCode(c[s]);return l=btoa(l)}hexify(e){return e.split("").map(function(e){return e.charCodeAt(0).toString(16)}).join("")}zfill(e,t){for(var r=e+"";r.length<t;)r="0"+r;return r}expmod(e,t,r){if(1==equalsInt(t,0))return int2bigInt(1,10);if(equalsInt(mod(t,int2bigInt(2,10)),0)){var s=dup(t);return rightShift_(s,1),powMod(this.expmod(e,s,r),[2,0],r)}return mod(mult(this.expmod(e,sub(t,int2bigInt(1,10)),r),e),r)}_rsa_encrypt(e,t,r){e=e.split("").reverse().join("");var s=str2bigInt(this.hexify(e),16),a=str2bigInt(t,16),n=str2bigInt(r,16),i=this.expmod(s,a,n),o=bigInt2str(i,16);return this.zfill(o,256).toLowerCase()}_encrypted_request(e){e=JSON.stringify(e);var t=this._create_secret_key(16);return{params:this._aes_encrypt(this._aes_encrypt(e,"0CoJUm6Qyw8W8jud"),t),encSecKey:this._rsa_encrypt(t,"010001","00e0b509f6259df8642dbc35662901477df22677ec152b5ff68ace615bb7b725152b3ab17a876aea8a5aa76d2e417629ec4ee341f56135fccf695280104e0312ecbda92557c93870114af6c9d05c4f7f0c3685b7a46bee255932575cce10b424d813cfe4875d3e82047b97ddef52741d546b8e289dc6935b3ece0462db0a22b8e7")}}}class NetEaseReq extends NetEaseSong{constructor(e){super(e)}async list(e,t){return await new Promise((r,s)=>{$.post(NetConfig.listUrl,{s:e,offset:NetConfig.offset,limit:t,type:NetConfig.type},e=>{let t=[];JSON.parse(e).result.songs.map((e,r)=>{t[r]={name:e.name,id:e.id,artists:e.artists.map(e=>e.name),album:e.album.name,netease:e.fee,duration:e.duration/1e3,cover:e.album.picUrl?e.album.picUrl:"",page:e.id}}),r(t)})})}async song(e){var t={ids:[e],br:NetConfig.br,csrf_token:NetConfig.csrf};const r=this._encrypted_request(t);return await new Promise((e,t)=>{$.post(NetConfig.songUrl,r,t=>{const r=JSON.parse(t).data[0].url;e(r)})})}async lyric(e){const t=this._encrypted_request({id:e,lv:-1,tv:-1,csrf_token:""});return await new Promise((e,r)=>{$.ajax({headers:{"Content-Type":"application/x-www-form-urlencoded"},type:"POST",url:"http://music.163.com/weapi/song/lyric?csrf_token=",data:t,success:function(t){const r=JSON.parse(t).lrc?JSON.parse(t).lrc:{lyric:""};e(r)}})})}async toplist(e){const t={id:e||NetConfig.defaultTop,n:1e4,csrf_token:""},r=this._encrypted_request(t);let s={data:[],updateTime:""};return await new Promise((e,t)=>{$.post(NetConfig.topListUrl,r,t=>{const r=JSON.parse(t).playlist;r.tracks.map((e,t)=>{t<NetConfig.maxListNumber&&(s.data[t]={name:e.name,id:e.id,artists:e.ar.map(e=>e.name),netease:e.fee,duration:e.dt/1e3,cover:r.coverImgUrl?r.coverImgUrl:"",page:e.id})}),s.updateTime=r.updateTime,e(s)})})}}const NetEase=new NetEaseReq;