const themeDefault="#27ae60",channelDefault="youtube",disabledTabDefault="xiami",homeModeDefault="lyric_mode";function rgb2hex(e){return"#"+hex((e=e.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/))[1])+hex(e[2])+hex(e[3])}function hex(e){var t=new Array("0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f");return isNaN(e)?"00":t[(e-e%16)/16]+t[e%16]}function save_options(){const e=document.getElementById("picker").style.backgroundColor,t=document.querySelector('input[name="channel"]:checked').value,n=document.querySelector('input[name="home"]:checked').value;if(e){const o=rgb2hex(e);chrome.storage.sync.set({customTheme:o,customChannel:t,customHomeMode:n},function(){})}}function reset_options(){document.getElementById("picker").style.backgroundColor=themeDefault,document.getElementById("youtube").checked=!0,document.getElementById("youtubeTab").checked=!0,document.getElementById("lyricMode").checked=!0,chrome.storage.sync.set({customTheme:themeDefault,customChannel:channelDefault,customDisabledTab:disabledTabDefault,customHomeMode:homeModeDefault},function(){})}Colorpicker.create({bindClass:"picker",change:function(e,t){e.style.backgroundColor=t}}),document.getElementById("op_save").addEventListener("click",save_options),document.getElementById("op_reset").addEventListener("click",reset_options);const handleInfoShow=function(e,t,n){const o=document.getElementById("load_info"),c="error"===e?"err_show":"success_show";o.innerText=t,o.classList.add(c),setTimeout(()=>{o.innerText="",o.classList.remove(c)},n)};function createAndDownloadFile(e,t){var n=document.createElement("a"),o=new Blob([t]);n.download=e,n.href=URL.createObjectURL(o),n.click(),URL.revokeObjectURL(o)}function restore_options(){chrome.storage.sync.get({customTheme:themeDefault,customChannel:channelDefault,customDisabledTab:disabledTabDefault,customHomeMode:homeModeDefault},function(e){document.getElementById("picker").style.backgroundColor=e.customTheme,document.getElementById(e.customChannel).checked=!0})}document.getElementById("song_load").addEventListener("change",function(e){const t=document.getElementById("song_load").files[0];var n=new FileReader;n.onload=function(e){const t=JSON.parse(n.result);t.length<=40?chrome.storage.sync.get({likeList:[]},function(e){chrome.storage.local.set({likeList:e.likeList},function(){chrome.storage.sync.set({likeList:t},function(){handleInfoShow("success","成功：新歌单已上传，本地备份最后一次被覆盖的歌单",3e3)})})}):handleInfoShow("error","错误：歌单不支持超过40首,请重新上传",3e3)},t.name.endsWith(".sps")?n.readAsText(t):handleInfoShow("error","错误：请上传正确的SPS歌单文件",3e3)}),document.getElementById("song_import").addEventListener("click",function(){document.getElementById("song_load").click()}),document.getElementById("song_export").addEventListener("click",function(){chrome.storage.sync.get({likeList:[]},function(e){const t=new Date,n=t.getMonth()+1,o=[t.getFullYear(),n<10?`0${n}`:n,t.getDate()].join("");createAndDownloadFile(`list_${e.likeList.length}_${o}.sps`,JSON.stringify(e.likeList))})}),document.getElementById("song_reset").addEventListener("click",function(){chrome.storage.local.get({likeList:[]},function(e){e.likeList.length?chrome.storage.sync.set({likeList:e.likeList},function(){handleInfoShow("success","成功：已成功还原最后一次备份",3e3)}):handleInfoShow("error","错误：备份为空或不存在，不替换当前歌单",3e3)})}),document.addEventListener("DOMContentLoaded",restore_options);